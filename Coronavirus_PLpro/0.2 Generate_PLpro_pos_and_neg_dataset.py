from tqdm import tqdm
import csv

PATH = "C:\\Users\\lprescott\\Documents\\Human proteome\\PLpro\\"
CoV_pp1as_file_name = "1.1 GanBank_all_cornidovirineae_orf1a_and_name_variants.fasta"
PLpro_cleavages_file_name = "2.3 PLpro_cuts_CoV_list_no_repeats_463x.txt"

positives = ['AKRGGGVFYT','AKRGGGVVYT','ARIGRGAIYV','ARTGNGAIYV','ARTGNGAVYV','ARTGNGTIYV','ARTGNGVIYV','ARTGRGAIYV','ARTGRGIIYV','ARTGRGVIYV','DGLAGAEVCV','DGLAGAEVYV','ELNGGACTRY','ELNGGAFTRY','ELNGGALTRY','ELNGGANTRY','ELNGGAVTRY','ELNGGAYNRY','ELNGGAYTCY','ELNGGAYTHY','ELNGGAYTRY','ELNGGTYTRY','ELNGGVVTRY','ELNGGVYTRY','ELNRGAYTRY','FGCGAGTSIP','FGCGGGTSIP','FGDGAGDVVF','FGFGGGDAGP','FGFGGGDASP','FGGCGGTVVP','FGGFGGNKIP','FGGRGGNTVH','FGGRGGNTVY','FGGRGGSTTY','FGGRGGSTVY','FGHGAGSVVF','FGHGGGNVEP','FGHRGGDVVY','FGHRGGNIVP','FGHVAGSVVF','FGKRGGDVVP','FGKRGGDVVS','FGKRGGNVVF','FGKRGGNVVS','FGNRGGTTVF','FGQTGGYVIP','FGRCGGNIVP','FGRCGGSTIP','FGRCGGTTIP','FGRQGGTTIP','FGRRGGDVVP','FGRRGGNIVP','FGRRGGNTIY','FGRRGGTTIP','FGSGGGDAGP','FGSRGGDTIF','FLTGGNDFHR','FRLLGGEQKV','GKRGGGNVIY','GKRGGGNVTY','GKRGGGSVTY','GKRGGGYVTF','GKSRGGIAPN','GKSRGGVAPN','GNKGAGGHSY','GNNGAGGHSY','GRRGGAPPIY','GRRGGGAVPV','GRRGGGTVTY','GRRGGGVIPV','GRRGGGVVPV','GRSRGGIAPN','IGRRGGNIVP','ININGGTIVY','INNIGGTVVY','INTNGGTVVH','INTNGGTVVY','KAKRGGDVYL','KAKRGGNAYM','KAKRGGNTFL','KAKRGGNVYM','KEKRGGDVYM','KGKRGGNVFL','KGYRGLKPIL','KGYRGVKPIL','KGYRGVKPLL','KGYRGVKPVL','KGYRGVKSIL','KLCGGDVIPV','KLCGGDVTPV','KLIGGDCIPI','KLIGGDCIPV','KLIGGDCVPV','KLIGGDVTPV','KLIGGEQKVV','KLIGGGCVPV','KLIGGVVTPV','KLTGGDFIPV','KLTGGDVTPV','KLVGGDCIPV','KLVGGDFIPI','KLVGGDFTPI','KLVGGDVIPI','KLVGGNFTPI','KTYRGVKPLL','LDGRGGTQIP','LGCRGGNIVP','LGRRGGNPPV','LGSGRGTIAP','NGFAGGVVNV','NGSAGSAVHV','NKGAGGHNGA','RAYRGIKPIL','RGHRGVKPLL','RGYRGIKPIL','RGYRGIKPLL','RGYRGLKPIL','RGYRGVKPIL','RGYRGVKPLL','RGYRGVNPIL','RLLGGEQKIV','RNLQSGRIFK','RQYRGIKPVL','RQYRGLKPLV','RSLGAGKQFK','RSYRGVKPLL','SGFAGNPINV','SGFAGNPVNV','SKRGGGNVTY','STYGGMIVYV','STYGGMTVYV','VNTNGGTVVY','VRTGRGAIYV','AFKAGSDELN','AFKAGSDELS','AFKAGSDSLN','AFKVGGLKPI','AFLAGVSDDI','ALKGGAPTKV','CLKGGSPTKG','DKNGGGVSFS','DKSGGGVSFS','DLRVACHPLK','EQPAAVKFAE','EQPAVVKFAE','FKKAGGQSVT','FKKVGGSAVT','FKQAGGQSVT','FKQAGGQVVT','FKRAGGQVVT','FKRGGGSVEF','FKRGGGTVEF','FVKAGGHVTL','GFKAGADQLT','GFKAGSDELF','GFKAGSDELL','GFKAGSDELV','GFKARSDELL','GFRAGADHLT','GFRAGADQLN','GFRAGADQLQ','ICKAGGKIVT','ICKAGGKTVM','ICKAGGKTVT','IKKGGGDVKF','ILKGGAPTKV','INKAGGKTVT','KKKGGGDVKF','KKKGGGDVRF','KKKGGGLVSI','KKKGGGSVSI','KKKGGGVVTI','KKRGGGDVKF','KKRGGGSVSF','KKVGGSAVTF','KLKGGAPIKK','KLKGGAPVKK','KLKGGAPVKR','KLKGGAPVRE','KLKGGMPSKK','KLKGGNPDKV','KRCGGGVIQF','KRNGGGVIQF','KRSGGGKLQF','KRSGGGVIQF','KRSGGGVVQF','NKAGGGKNVT','NKKGGGVVSF','NKLGGGDKSV','NKMGGGDKFV','NKMGGGDKSV','NKMGGGDKTV','NKMGGGDKVV','NKMGGGGKSV','NKSGGDVKNV','NKVGGGKNVT','NKVGGGKTVT','QKKCGGVVKI','QKKGGGVVTI','RFPCAGKKIS','RFPCAGKKVA','RFPCAGKKVE','RFPCAGKKVG','RFPCAGKKVV','RFPCAGKRVE','RFPCAGKSVS','RFPCAGKSVT','RFPCAGRKVE','RFPCAGRKVG','RFPCAGRKVN','RFPCAGRRVT','RFPCGGKKIS','RIPCAGRHVS','RKKAGGKNVA','RKKGGGNVSF','RKKGGGVVTF','RKLGGAGVAF','RKVGGGKLQF','RLKGGAPIKG','RLKGGAPIKK','RLKGGAPIKS','RLKGGAPIRG','RLKGGAPPKG','RLKGGAPTKG','RLKGGAPTKK','RLKGGAPTKV','RLKGGAPVKG','RLKGGAPVKK','RLKGGMPSKK','RLKGGMPSKN','RLKGGSPIKG','RLKGGSPVKG','RLNGGAPVKG','RLNGGAPVKS','RLRGGAPTKG','RLRGGGAPKV','RLRGGGGVNK','RLRGGGGVRK','RLRGGGKPKV','RLRGGGPGKV','RLRGGGPPKV','RLRGGGTPKV','RLRGGGVSKV','RVPCAGKHVT','RVPCAGKRVT','RVPCAGRCVT','RVPCAGRRVT','RVPRAGRHVT','RVPRAGRRVT','RVPRARRCVT','SKSAGGKISF','SLKGGAPVKG','SYSGNGMDYN','TKAAGGKVSF','TKKCGGSVSF','TKLAGGKISF','TKNAGGKITF','TKSAGGKVSF','TLKGGAPIKK','TLKGGAPLKR','TLKGGAPSKG','TLKGGAPTKG','TLKGGAPTKV','TLKGGAPTRV','TLKGGASTKV','TLKGGEQTKV','TLKGSAPTKV','TLRGGAPTKV','VCKAGGKIVT','VCKAGGKTVT','VCKARGKTVT','VCKCGAQVEL','VCRAGGKTVT','VFKAAGSPLA','YKLGGGDRVT','YKLGGGKVDN','YKLGGSDDAL','YKLGGSDVAH','YKQGGGKVTF','YKRGSGINGT','YKRGSGKSVQ','YKRGSGTNGT','YNKAGGDAKN','YNKAGGDIKN','YNKAGGDVKN','YNKSGGDVKN','AKNGSGFFDV','AKNGSGFFNV','AKQGAGDAGH','AKQGAGDAVH','AKQGAGESGR','AKQGAGFKRT','AKQGAGGSGR','AKQGAGKTGH','AKSGSGFFDV','ALKGGKFVTN','ALKGGKIVNN','ALKGGKNINN','ALKVGKIVNN','ALRGGKIVNN','CKKGGAIKPF','CKKGGAKSLS','CKKGGALPGH','CKKGGAPSVR','CKKGGAVGAR','DKKAGGILKD','DKKAGGILND','DKKAGGVLKD','EEKAGGVVSG','EKKAGAVISG','EKKAGGAISG','EKKAGGAVSS','EKKAGGIIGG','EKKAGGIISG','EKKAGGITGG','EKKAGGIVGG','EKKAGGIVGS','EKKAGGIVSD','EKKAGGIVSG','EKKAGGIVSS','EKKAGGIVVG','EKKAGGLVKE','EKKAGGLVSS','EKKAGGTISG','EKKAGGVFSS','EKKAGGVING','EKKAGGVINN','EKKAGGVISG','EKKAGGVISN','EKKAGGVISS','EKKAGGVTSD','EKKAGGVVCN','EKKAGGVVGS','EKKAGGVVNN','EKKAGGVVNS','EKKAGGVVSD','EKKAGGVVSG','EKKAGGVVSI','EKKAGGVVSN','EKKAGGVVSS','EKKAGGVVTN','EKKAGSVVSS','EKNAGGVVSS','EKRAGGIVGS','EKRAGGVVNN','EKRAGGVVSS','EKTAGGVVSS','GKKAGGIISG','GKKGGSTVSA','GKKGSGLKQC','GKNGSGIKRC','GKQGSGLKKC','GMKGGSKTVN','IKKGGARFDK','KFVGGSLNSK','KIIGGHRRIV','KIIGGHRRLV','KIIGGHRRSI','KIIGGHRRVI','KIVGGAHTWF','KIVGGAPIWF','KIVGGAPSWL','KIVGGAPSWV','KIVGGAPTWF','KIVGGAPTWY','KIVGGASTWF','KIVGGHCRNI','KIVGGHKRIV','KIVGGHRRNI','KIVGGYRRNI','KKKAGGVVSS','KKKGGNPPSW','KKNGGNPPSW','KLSGGAPKWL','KLSGGAPRWL','KTVGGAKSWM','KTVGGAPNWL','KVVGGNKRVI','MFSGGATYTT','NIKTGGNKVY','NKKGADLPSF','NKKGAGFPSF','NKKGAGFPSL','NKKGAGFPTL','NKKGAGLHSF','NKKGAGLPIF','NKKGAGLPSF','NKKGAGLPSI','NKKGAGLPSL','NKKGAGLPTL','NKKGAGLSSF','NKKGAGVPSF','NKKGAGVSSK','NKKGAGVSSS','NKNGAGLPSF','NKRAAGVGSK','NKRGAGLPSF','NTKGAGLPSF','NVKAGGVVSN','PKKGSGFFDV','PKNGSGFFDV','PKSGSGFFDV','QKNAGFESGF','QKNAGFESSF','QKQGAGKLSS','QKQGAGKLSY','QKQGSGKLSS','RIKAGALPSR','RIKAGAPPMH','RIKAGAPPMR','RIKAGAPPVR','RIKAGASPSR','RIKAGKFSNQ','RIKAGRKPRS','RIKAGSAAKH','RIKAGVPPMR','RKEGGAVRPF','RKSGSGFFDI','RKSGSGFFDV','RLKAGAMPSR','RLKAGARITI','RLKAGAVPSR','RVKAGSDNKH','RVVGGHRRKV','SKKGAGPKKS','SKKGAGPKRR','SKKGSGLKQC','SKNAGIPLGR','SKQGAGFKKT','SKQGAGFKRT','SKQGAGKTGR','SKQGSGLRRC','SKSAGFPNPM','SKSAGLPNPM','SKSGSGFFDV','SLKGGAFVSN','SLKGGAGFSN','SLKGGAIFSY','SLKGGAILSN','SLKGGALVSN','SLKGGAMFSR','SLKGGAVFSH','SLKGGAVFSK','SLKGGAVFSR','SLKGGAVFSY','SLKGGAVLSN','SLKGGKFVSN','SLKGGKIIST','SLKGGKIVST','SLKGGKLNNT','SLKGGKVGST','SLKGGKVIST','SLKGGKVVST','SLKGGNVVNF','SLKGGVVLSN','TAKAGAGVSD','TKCGSGIKHC','TKCGSGIRKC','TKCGSGIRRC','TKFVGGSLNS','TKFVGGSVSG','VKRGSGVIPD','VLKGGKIVNN']

def read_CoV_fasta(CoV_pp1as_file_name):
    # read human proteome fasta
    com = open(PATH + CoV_pp1as_file_name, 'r')
    comIDList = []
    comSeqList = []
    tempSeq = ''
    for i, line in enumerate(com):
        if line.split(' ')[0][0] == '>':
            if tempSeq != '':
                comSeqList.append(tempSeq)
                tempSeq = ''
            comIDList.append(line.split(' ')[0])
        else:
            tempSeq = tempSeq + line.replace("\n", "")
    comSeqList.append(tempSeq) #add one last seq
    
    return comIDList, comSeqList



def main():
    CoV_IDs, CoV_pp1as = read_CoV_fasta(CoV_pp1as_file_name)
    #pos_seqs, pos_nums = read_pos_file()
    
    with open(PATH + '2.4 PLpro_negatives_2ormore_Gs_and_As_no_repeats.csv', 'w', newline='') as csvfile:
        writer = csv.writer(csvfile)
        
        negatives = []
        for i, pp1a in enumerate(tqdm(CoV_pp1as)):
            for j in range(len(pp1a)-10):
                if pp1a[j+3:j+6].count("G") + pp1a[j+3:j+6].count("A") >= 2 and "X" not in pp1a[j:j+10] and "B" not in pp1a[j:j+10] and "J" not in pp1a[j:j+10] and "Z" not in pp1a[j:j+10] and pp1a[j:j+10] not in positives and pp1a[j:j+10] not in negatives:
                    negatives.append(pp1a[j:j+10])
                    writer.writerow([pp1a[j:j+10]])
                    #print(pp1a[j:j+10])
    
    print(len(positives), len(negatives))
    print(len(CoV_IDs), len(CoV_pp1as))

main()